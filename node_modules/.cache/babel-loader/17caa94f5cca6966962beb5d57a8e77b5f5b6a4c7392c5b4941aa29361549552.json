{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._fetchTxtRecords = void 0;\n// See example: https://github.com/statsig-io/private-js-client-monorepo/pull/340\nconst FEATURE_ASSETS_DNS_QUERY = new Uint8Array([0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x66, 0x65, 0x61, 0x74, 0x75, 0x72, 0x65, 0x61, 0x73, 0x73, 0x65, 0x74, 0x73, 0x03, 0x6f, 0x72, 0x67, 0x00, 0x00, 0x10, 0x00, 0x01]);\nconst DNS_QUERY_ENDPOINT = 'https://cloudflare-dns.com/dns-query';\nconst DOMAIN_CHARS = ['i',\n// initialize\n'e',\n// events\n'd' // dcs\n];\nconst MAX_START_LOOKUP = 200;\nfunction _fetchTxtRecords(networkFunc) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const response = yield networkFunc(DNS_QUERY_ENDPOINT, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/dns-message',\n        Accept: 'application/dns-message'\n      },\n      body: FEATURE_ASSETS_DNS_QUERY\n    });\n    if (!response.ok) {\n      const err = new Error('Failed to fetch TXT records from DNS');\n      err.name = 'DnsTxtFetchError';\n      throw err;\n    }\n    const data = yield response.arrayBuffer();\n    const bytes = new Uint8Array(data);\n    return _parseDnsResponse(bytes);\n  });\n}\nexports._fetchTxtRecords = _fetchTxtRecords;\nfunction _parseDnsResponse(input) {\n  // loop until we find the first valid domain char. One of [i=, e=, d=]\n  const start = input.findIndex((byte, index) => index < MAX_START_LOOKUP && String.fromCharCode(byte) === '=' && DOMAIN_CHARS.includes(String.fromCharCode(input[index - 1])));\n  if (start === -1) {\n    const err = new Error('Failed to parse TXT records from DNS');\n    err.name = 'DnsTxtParseError';\n    throw err;\n  }\n  // decode the remaining bytes as a string\n  let result = '';\n  for (let i = start - 1; i < input.length; i++) {\n    result += String.fromCharCode(input[i]);\n  }\n  return result.split(',');\n}","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","_fetchTxtRecords","FEATURE_ASSETS_DNS_QUERY","Uint8Array","DNS_QUERY_ENDPOINT","DOMAIN_CHARS","MAX_START_LOOKUP","networkFunc","response","method","headers","Accept","body","ok","err","Error","name","data","arrayBuffer","bytes","_parseDnsResponse","input","start","findIndex","byte","index","String","fromCharCode","includes","i","length","split"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/client-core/src/DnsTxtQuery.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports._fetchTxtRecords = void 0;\n// See example: https://github.com/statsig-io/private-js-client-monorepo/pull/340\nconst FEATURE_ASSETS_DNS_QUERY = new Uint8Array([\n    0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d,\n    0x66, 0x65, 0x61, 0x74, 0x75, 0x72, 0x65, 0x61, 0x73, 0x73, 0x65, 0x74, 0x73,\n    0x03, 0x6f, 0x72, 0x67, 0x00, 0x00, 0x10, 0x00, 0x01,\n]);\nconst DNS_QUERY_ENDPOINT = 'https://cloudflare-dns.com/dns-query';\nconst DOMAIN_CHARS = [\n    'i', // initialize\n    'e', // events\n    'd', // dcs\n];\nconst MAX_START_LOOKUP = 200;\nfunction _fetchTxtRecords(networkFunc) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const response = yield networkFunc(DNS_QUERY_ENDPOINT, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/dns-message',\n                Accept: 'application/dns-message',\n            },\n            body: FEATURE_ASSETS_DNS_QUERY,\n        });\n        if (!response.ok) {\n            const err = new Error('Failed to fetch TXT records from DNS');\n            err.name = 'DnsTxtFetchError';\n            throw err;\n        }\n        const data = yield response.arrayBuffer();\n        const bytes = new Uint8Array(data);\n        return _parseDnsResponse(bytes);\n    });\n}\nexports._fetchTxtRecords = _fetchTxtRecords;\nfunction _parseDnsResponse(input) {\n    // loop until we find the first valid domain char. One of [i=, e=, d=]\n    const start = input.findIndex((byte, index) => index < MAX_START_LOOKUP &&\n        String.fromCharCode(byte) === '=' &&\n        DOMAIN_CHARS.includes(String.fromCharCode(input[index - 1])));\n    if (start === -1) {\n        const err = new Error('Failed to parse TXT records from DNS');\n        err.name = 'DnsTxtParseError';\n        throw err;\n    }\n    // decode the remaining bytes as a string\n    let result = '';\n    for (let i = start - 1; i < input.length; i++) {\n        result += String.fromCharCode(input[i]);\n    }\n    return result.split(',');\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}