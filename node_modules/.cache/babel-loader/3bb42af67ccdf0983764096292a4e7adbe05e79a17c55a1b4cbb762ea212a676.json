{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst client_core_1 = require(\"@statsig/client-core\");\nconst EvaluationResponseDeltas_1 = require(\"./EvaluationResponseDeltas\");\nclass StatsigNetwork extends client_core_1.NetworkCore {\n  constructor(options, emitter) {\n    super(options, emitter);\n    const config = options === null || options === void 0 ? void 0 : options.networkConfig;\n    this._option = options;\n    this._initializeUrlConfig = new client_core_1.UrlConfiguration(client_core_1.Endpoint._initialize, config === null || config === void 0 ? void 0 : config.initializeUrl, config === null || config === void 0 ? void 0 : config.api, config === null || config === void 0 ? void 0 : config.initializeFallbackUrls);\n  }\n  fetchEvaluations(sdkKey, current, priority, user, isCacheValidFor204) {\n    return __awaiter(this, void 0, void 0, function* () {\n      var _a, _b, _c, _d, _e, _f;\n      const cache = current ? (0, client_core_1._typedJsonParse)(current, 'has_updates', 'InitializeResponse') : null;\n      let data = {\n        user,\n        hash: (_c = (_b = (_a = this._option) === null || _a === void 0 ? void 0 : _a.networkConfig) === null || _b === void 0 ? void 0 : _b.initializeHashAlgorithm) !== null && _c !== void 0 ? _c : 'djb2',\n        deltasResponseRequested: false,\n        full_checksum: null\n      };\n      if (cache === null || cache === void 0 ? void 0 : cache.has_updates) {\n        const hasHashChanged = (cache === null || cache === void 0 ? void 0 : cache.hash_used) !== ((_f = (_e = (_d = this._option) === null || _d === void 0 ? void 0 : _d.networkConfig) === null || _e === void 0 ? void 0 : _e.initializeHashAlgorithm) !== null && _f !== void 0 ? _f : 'djb2');\n        data = Object.assign(Object.assign({}, data), {\n          sinceTime: isCacheValidFor204 && !hasHashChanged ? cache.time : 0,\n          previousDerivedFields: 'derived_fields' in cache && isCacheValidFor204 ? cache.derived_fields : {},\n          deltasResponseRequested: true,\n          full_checksum: cache.full_checksum,\n          partialUserMatchSinceTime: !hasHashChanged ? cache.time : 0\n        });\n      }\n      return this._fetchEvaluations(sdkKey, cache, data, priority);\n    });\n  }\n  _fetchEvaluations(sdkKey, cache, data, priority) {\n    return __awaiter(this, void 0, void 0, function* () {\n      var _a, _b;\n      const response = yield this.post({\n        sdkKey,\n        urlConfig: this._initializeUrlConfig,\n        data,\n        retries: 2,\n        isStatsigEncodable: true,\n        priority\n      });\n      if ((response === null || response === void 0 ? void 0 : response.code) === 204) {\n        return '{\"has_updates\": false}';\n      }\n      if ((response === null || response === void 0 ? void 0 : response.code) !== 200) {\n        return (_a = response === null || response === void 0 ? void 0 : response.body) !== null && _a !== void 0 ? _a : null;\n      }\n      if ((cache === null || cache === void 0 ? void 0 : cache.has_updates) !== true || ((_b = response.body) === null || _b === void 0 ? void 0 : _b.includes('\"is_delta\":true')) !== true || data.deltasResponseRequested !== true) {\n        return response.body;\n      }\n      const result = (0, EvaluationResponseDeltas_1._resolveDeltasResponse)(cache, response.body);\n      if (typeof result === 'string') {\n        return result;\n      }\n      // retry without deltas\n      return this._fetchEvaluations(sdkKey, cache, Object.assign(Object.assign(Object.assign({}, data), result), {\n        deltasResponseRequested: false\n      }), priority);\n    });\n  }\n}\nexports.default = StatsigNetwork;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","client_core_1","require","EvaluationResponseDeltas_1","StatsigNetwork","NetworkCore","constructor","options","emitter","config","networkConfig","_option","_initializeUrlConfig","UrlConfiguration","Endpoint","_initialize","initializeUrl","api","initializeFallbackUrls","fetchEvaluations","sdkKey","current","priority","user","isCacheValidFor204","_a","_b","_c","_d","_e","_f","cache","_typedJsonParse","data","hash","initializeHashAlgorithm","deltasResponseRequested","full_checksum","has_updates","hasHashChanged","hash_used","assign","sinceTime","time","previousDerivedFields","derived_fields","partialUserMatchSinceTime","_fetchEvaluations","response","post","urlConfig","retries","isStatsigEncodable","code","body","includes","_resolveDeltasResponse","default"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/js-client/src/Network.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst client_core_1 = require(\"@statsig/client-core\");\nconst EvaluationResponseDeltas_1 = require(\"./EvaluationResponseDeltas\");\nclass StatsigNetwork extends client_core_1.NetworkCore {\n    constructor(options, emitter) {\n        super(options, emitter);\n        const config = options === null || options === void 0 ? void 0 : options.networkConfig;\n        this._option = options;\n        this._initializeUrlConfig = new client_core_1.UrlConfiguration(client_core_1.Endpoint._initialize, config === null || config === void 0 ? void 0 : config.initializeUrl, config === null || config === void 0 ? void 0 : config.api, config === null || config === void 0 ? void 0 : config.initializeFallbackUrls);\n    }\n    fetchEvaluations(sdkKey, current, priority, user, isCacheValidFor204) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a, _b, _c, _d, _e, _f;\n            const cache = current\n                ? (0, client_core_1._typedJsonParse)(current, 'has_updates', 'InitializeResponse')\n                : null;\n            let data = {\n                user,\n                hash: (_c = (_b = (_a = this._option) === null || _a === void 0 ? void 0 : _a.networkConfig) === null || _b === void 0 ? void 0 : _b.initializeHashAlgorithm) !== null && _c !== void 0 ? _c : 'djb2',\n                deltasResponseRequested: false,\n                full_checksum: null,\n            };\n            if (cache === null || cache === void 0 ? void 0 : cache.has_updates) {\n                const hasHashChanged = (cache === null || cache === void 0 ? void 0 : cache.hash_used) !==\n                    ((_f = (_e = (_d = this._option) === null || _d === void 0 ? void 0 : _d.networkConfig) === null || _e === void 0 ? void 0 : _e.initializeHashAlgorithm) !== null && _f !== void 0 ? _f : 'djb2');\n                data = Object.assign(Object.assign({}, data), { sinceTime: isCacheValidFor204 && !hasHashChanged ? cache.time : 0, previousDerivedFields: 'derived_fields' in cache && isCacheValidFor204\n                        ? cache.derived_fields\n                        : {}, deltasResponseRequested: true, full_checksum: cache.full_checksum, partialUserMatchSinceTime: !hasHashChanged ? cache.time : 0 });\n            }\n            return this._fetchEvaluations(sdkKey, cache, data, priority);\n        });\n    }\n    _fetchEvaluations(sdkKey, cache, data, priority) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a, _b;\n            const response = yield this.post({\n                sdkKey,\n                urlConfig: this._initializeUrlConfig,\n                data,\n                retries: 2,\n                isStatsigEncodable: true,\n                priority,\n            });\n            if ((response === null || response === void 0 ? void 0 : response.code) === 204) {\n                return '{\"has_updates\": false}';\n            }\n            if ((response === null || response === void 0 ? void 0 : response.code) !== 200) {\n                return (_a = response === null || response === void 0 ? void 0 : response.body) !== null && _a !== void 0 ? _a : null;\n            }\n            if ((cache === null || cache === void 0 ? void 0 : cache.has_updates) !== true ||\n                ((_b = response.body) === null || _b === void 0 ? void 0 : _b.includes('\"is_delta\":true')) !== true ||\n                data.deltasResponseRequested !== true) {\n                return response.body;\n            }\n            const result = (0, EvaluationResponseDeltas_1._resolveDeltasResponse)(cache, response.body);\n            if (typeof result === 'string') {\n                return result;\n            }\n            // retry without deltas\n            return this._fetchEvaluations(sdkKey, cache, Object.assign(Object.assign(Object.assign({}, data), result), { deltasResponseRequested: false }), priority);\n        });\n    }\n}\nexports.default = StatsigNetwork;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}