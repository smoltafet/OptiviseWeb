{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._resolveDeltasResponse = void 0;\nconst client_core_1 = require(\"@statsig/client-core\");\nconst MAX_DELTAS_SORT_DEPTH = 2;\nfunction _resolveDeltasResponse(cache, deltasString) {\n  const deltas = (0, client_core_1._typedJsonParse)(deltasString, 'checksum', 'DeltasEvaluationResponse');\n  if (!deltas) {\n    return {\n      hadBadDeltaChecksum: true\n    };\n  }\n  const merged = _mergeDeltasIntoCache(cache, deltas);\n  const resolved = _handleDeletedEntries(merged);\n  const actualChecksum = (0, client_core_1._DJB2Object)({\n    feature_gates: resolved.feature_gates,\n    dynamic_configs: resolved.dynamic_configs,\n    layer_configs: resolved.layer_configs\n  }, MAX_DELTAS_SORT_DEPTH);\n  const isMatch = actualChecksum === deltas.checksumV2;\n  if (!isMatch) {\n    return {\n      hadBadDeltaChecksum: true,\n      badChecksum: actualChecksum,\n      badMergedConfigs: resolved,\n      badFullResponse: deltas.deltas_full_response\n    };\n  }\n  return JSON.stringify(resolved);\n}\nexports._resolveDeltasResponse = _resolveDeltasResponse;\nfunction _mergeDeltasIntoCache(cache, deltas) {\n  return Object.assign(Object.assign(Object.assign({}, cache), deltas), {\n    feature_gates: Object.assign(Object.assign({}, cache.feature_gates), deltas.feature_gates),\n    layer_configs: Object.assign(Object.assign({}, cache.layer_configs), deltas.layer_configs),\n    dynamic_configs: Object.assign(Object.assign({}, cache.dynamic_configs), deltas.dynamic_configs)\n  });\n}\nfunction _handleDeletedEntries(deltas) {\n  const result = deltas;\n  _deleteEntriesInRecord(deltas.deleted_gates, result.feature_gates);\n  delete result.deleted_gates;\n  _deleteEntriesInRecord(deltas.deleted_configs, result.dynamic_configs);\n  delete result.deleted_configs;\n  _deleteEntriesInRecord(deltas.deleted_layers, result.layer_configs);\n  delete result.deleted_layers;\n  return result;\n}\nfunction _deleteEntriesInRecord(keys, values) {\n  keys === null || keys === void 0 ? void 0 : keys.forEach(key => {\n    delete values[key];\n  });\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","_resolveDeltasResponse","client_core_1","require","MAX_DELTAS_SORT_DEPTH","cache","deltasString","deltas","_typedJsonParse","hadBadDeltaChecksum","merged","_mergeDeltasIntoCache","resolved","_handleDeletedEntries","actualChecksum","_DJB2Object","feature_gates","dynamic_configs","layer_configs","isMatch","checksumV2","badChecksum","badMergedConfigs","badFullResponse","deltas_full_response","JSON","stringify","assign","result","_deleteEntriesInRecord","deleted_gates","deleted_configs","deleted_layers","keys","values","forEach","key"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/js-client/src/EvaluationResponseDeltas.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports._resolveDeltasResponse = void 0;\nconst client_core_1 = require(\"@statsig/client-core\");\nconst MAX_DELTAS_SORT_DEPTH = 2;\nfunction _resolveDeltasResponse(cache, deltasString) {\n    const deltas = (0, client_core_1._typedJsonParse)(deltasString, 'checksum', 'DeltasEvaluationResponse');\n    if (!deltas) {\n        return {\n            hadBadDeltaChecksum: true,\n        };\n    }\n    const merged = _mergeDeltasIntoCache(cache, deltas);\n    const resolved = _handleDeletedEntries(merged);\n    const actualChecksum = (0, client_core_1._DJB2Object)({\n        feature_gates: resolved.feature_gates,\n        dynamic_configs: resolved.dynamic_configs,\n        layer_configs: resolved.layer_configs,\n    }, MAX_DELTAS_SORT_DEPTH);\n    const isMatch = actualChecksum === deltas.checksumV2;\n    if (!isMatch) {\n        return {\n            hadBadDeltaChecksum: true,\n            badChecksum: actualChecksum,\n            badMergedConfigs: resolved,\n            badFullResponse: deltas.deltas_full_response,\n        };\n    }\n    return JSON.stringify(resolved);\n}\nexports._resolveDeltasResponse = _resolveDeltasResponse;\nfunction _mergeDeltasIntoCache(cache, deltas) {\n    return Object.assign(Object.assign(Object.assign({}, cache), deltas), { feature_gates: Object.assign(Object.assign({}, cache.feature_gates), deltas.feature_gates), layer_configs: Object.assign(Object.assign({}, cache.layer_configs), deltas.layer_configs), dynamic_configs: Object.assign(Object.assign({}, cache.dynamic_configs), deltas.dynamic_configs) });\n}\nfunction _handleDeletedEntries(deltas) {\n    const result = deltas;\n    _deleteEntriesInRecord(deltas.deleted_gates, result.feature_gates);\n    delete result.deleted_gates;\n    _deleteEntriesInRecord(deltas.deleted_configs, result.dynamic_configs);\n    delete result.deleted_configs;\n    _deleteEntriesInRecord(deltas.deleted_layers, result.layer_configs);\n    delete result.deleted_layers;\n    return result;\n}\nfunction _deleteEntriesInRecord(keys, values) {\n    keys === null || keys === void 0 ? void 0 : keys.forEach((key) => {\n        delete values[key];\n    });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}