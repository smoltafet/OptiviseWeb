{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionReplayClient = void 0;\nconst record_1 = require(\"@rrweb/record\");\nconst client_core_1 = require(\"@statsig/client-core\");\nconst TIMEOUT_MS = 1000 * 60 * 60 * 4; // 4 hours\nconst CHECKOUT_WINDOW_MS = 1000 * 30; // 30 seconds\nclass SessionReplayClient {\n  constructor() {\n    this._startTimestamp = null;\n    this._endTimestamp = null;\n  }\n  record(callback, config, stopCallback, keepRollingWindow = false) {\n    if ((0, client_core_1._getDocumentSafe)() == null) {\n      return;\n    }\n    // Always reset session id and tracking fields for a new recording\n    this._startTimestamp = null;\n    this._endTimestamp = null;\n    this._stopCallback = stopCallback;\n    if (this._stopFn) {\n      return;\n    }\n    const emit = (event, isCheckOut) => {\n      var _a, _b, _c;\n      if (keepRollingWindow) {\n        // Reset start at each checkout\n        this._startTimestamp = isCheckOut ? event.timestamp : (_a = this._startTimestamp) !== null && _a !== void 0 ? _a : event.timestamp;\n      } else {\n        // Reset start only for the first event\n        (_b = this._startTimestamp) !== null && _b !== void 0 ? _b : this._startTimestamp = event.timestamp;\n      }\n      // Always keep a running end timestamp\n      this._endTimestamp = event.timestamp;\n      let clickCount = 0;\n      // Count clicks only for events representing a click\n      if (_isClickEvent(event)) {\n        clickCount++;\n      }\n      callback(Object.assign(Object.assign({}, event), {\n        eventIndex: 0\n      }), {\n        startTime: this._startTimestamp,\n        endTime: this._endTimestamp,\n        clickCount\n      }, isCheckOut !== null && isCheckOut !== void 0 ? isCheckOut : false);\n      if (this._endTimestamp - this._startTimestamp > TIMEOUT_MS) {\n        (_c = this._stopFn) === null || _c === void 0 ? void 0 : _c.call(this);\n        if (this._stopCallback) {\n          this._stopCallback();\n        }\n      }\n    };\n    this._stopFn = _minifiedAwareRecord(emit, config, keepRollingWindow);\n  }\n  stop() {\n    if (this._stopFn) {\n      this._stopFn();\n      this._stopFn = undefined;\n    }\n  }\n  isRecording() {\n    return this._stopFn != null;\n  }\n}\nexports.SessionReplayClient = SessionReplayClient;\n/**\n * We do a simple concat of rrweb during minification.\n * This function ensures we handle both \"npm\" and \"<script ..>\" install options.\n */\nfunction _minifiedAwareRecord(emit, config, keepRollingWindow) {\n  if (keepRollingWindow) {\n    return (0, record_1.record)(Object.assign(Object.assign({}, config), {\n      emit,\n      checkoutEveryNms: CHECKOUT_WINDOW_MS\n    }));\n  } else {\n    return (0, record_1.record)(Object.assign(Object.assign({}, config), {\n      emit\n    }));\n  }\n}\nfunction _isClickEvent(event) {\n  // we use the raw number so we can support the minified rrweb file.\n  return event.type === 3 &&\n  // rrweb.EventType.IncrementalSnapshot &&\n  event.data.source === 2 && (\n  // rrweb.IncrementalSource.MouseInteraction &&\n  event.data.type === 2 /* rrweb.MouseInteractions.Click */ || event.data.type === 4) /* rrweb.MouseInteractions.DbClick */;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","SessionReplayClient","record_1","require","client_core_1","TIMEOUT_MS","CHECKOUT_WINDOW_MS","constructor","_startTimestamp","_endTimestamp","record","callback","config","stopCallback","keepRollingWindow","_getDocumentSafe","_stopCallback","_stopFn","emit","event","isCheckOut","_a","_b","_c","timestamp","clickCount","_isClickEvent","assign","eventIndex","startTime","endTime","call","_minifiedAwareRecord","stop","undefined","isRecording","checkoutEveryNms","type","data","source"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/session-replay/src/SessionReplayClient.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SessionReplayClient = void 0;\nconst record_1 = require(\"@rrweb/record\");\nconst client_core_1 = require(\"@statsig/client-core\");\nconst TIMEOUT_MS = 1000 * 60 * 60 * 4; // 4 hours\nconst CHECKOUT_WINDOW_MS = 1000 * 30; // 30 seconds\nclass SessionReplayClient {\n    constructor() {\n        this._startTimestamp = null;\n        this._endTimestamp = null;\n    }\n    record(callback, config, stopCallback, keepRollingWindow = false) {\n        if ((0, client_core_1._getDocumentSafe)() == null) {\n            return;\n        }\n        // Always reset session id and tracking fields for a new recording\n        this._startTimestamp = null;\n        this._endTimestamp = null;\n        this._stopCallback = stopCallback;\n        if (this._stopFn) {\n            return;\n        }\n        const emit = (event, isCheckOut) => {\n            var _a, _b, _c;\n            if (keepRollingWindow) {\n                // Reset start at each checkout\n                this._startTimestamp = isCheckOut\n                    ? event.timestamp\n                    : (_a = this._startTimestamp) !== null && _a !== void 0 ? _a : event.timestamp;\n            }\n            else {\n                // Reset start only for the first event\n                (_b = this._startTimestamp) !== null && _b !== void 0 ? _b : (this._startTimestamp = event.timestamp);\n            }\n            // Always keep a running end timestamp\n            this._endTimestamp = event.timestamp;\n            let clickCount = 0;\n            // Count clicks only for events representing a click\n            if (_isClickEvent(event)) {\n                clickCount++;\n            }\n            callback(Object.assign(Object.assign({}, event), { eventIndex: 0 }), {\n                startTime: this._startTimestamp,\n                endTime: this._endTimestamp,\n                clickCount,\n            }, isCheckOut !== null && isCheckOut !== void 0 ? isCheckOut : false);\n            if (this._endTimestamp - this._startTimestamp > TIMEOUT_MS) {\n                (_c = this._stopFn) === null || _c === void 0 ? void 0 : _c.call(this);\n                if (this._stopCallback) {\n                    this._stopCallback();\n                }\n            }\n        };\n        this._stopFn = _minifiedAwareRecord(emit, config, keepRollingWindow);\n    }\n    stop() {\n        if (this._stopFn) {\n            this._stopFn();\n            this._stopFn = undefined;\n        }\n    }\n    isRecording() {\n        return this._stopFn != null;\n    }\n}\nexports.SessionReplayClient = SessionReplayClient;\n/**\n * We do a simple concat of rrweb during minification.\n * This function ensures we handle both \"npm\" and \"<script ..>\" install options.\n */\nfunction _minifiedAwareRecord(emit, config, keepRollingWindow) {\n    if (keepRollingWindow) {\n        return (0, record_1.record)(Object.assign(Object.assign({}, config), { emit, checkoutEveryNms: CHECKOUT_WINDOW_MS }));\n    }\n    else {\n        return (0, record_1.record)(Object.assign(Object.assign({}, config), { emit }));\n    }\n}\nfunction _isClickEvent(event) {\n    // we use the raw number so we can support the minified rrweb file.\n    return (event.type === 3 && // rrweb.EventType.IncrementalSnapshot &&\n        event.data.source === 2 && // rrweb.IncrementalSource.MouseInteraction &&\n        (event.data.type === 2 /* rrweb.MouseInteractions.Click */ ||\n            event.data.type === 4) /* rrweb.MouseInteractions.DbClick */);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}