{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebVitalsManager = void 0;\nconst web_vitals_1 = require(\"web-vitals\");\nconst client_core_1 = require(\"@statsig/client-core\");\nconst AutoCaptureEvent_1 = require(\"./AutoCaptureEvent\");\nconst commonUtils_1 = require(\"./utils/commonUtils\");\nconst VALID_METRIC_NAMES = ['CLS', 'FCP', 'INP', 'LCP', 'TTFB'];\nclass WebVitalsManager {\n  constructor(_enqueueFn, _errorBoundary) {\n    this._enqueueFn = _enqueueFn;\n    this._errorBoundary = _errorBoundary;\n    this._isInitialized = false;\n    this._metricEvent = {\n      url: (0, commonUtils_1._getSafeUrlString)(),\n      sanitizedUrl: (0, commonUtils_1._getSanitizedPageUrl)(),\n      metrics: [],\n      firstMetricTimestamp: undefined\n    };\n  }\n  startTracking() {\n    var _a, _b;\n    try {\n      if (this._isInitialized) {\n        return;\n      }\n      const protocol = (_b = (_a = (0, client_core_1._getWindowSafe)()) === null || _a === void 0 ? void 0 : _a.location) === null || _b === void 0 ? void 0 : _b.protocol;\n      if (protocol !== 'https:' && protocol !== 'http:') {\n        return;\n      }\n      (0, web_vitals_1.onCLS)(metric => this._handleMetric(metric));\n      (0, web_vitals_1.onFCP)(metric => this._handleMetric(metric));\n      (0, web_vitals_1.onINP)(metric => this._handleMetric(metric));\n      (0, web_vitals_1.onLCP)(metric => this._handleMetric(metric));\n      (0, web_vitals_1.onTTFB)(metric => this._handleMetric(metric));\n      this._isInitialized = true;\n    } catch (error) {\n      client_core_1.Log.error('Error starting web vitals tracking', error);\n      this._errorBoundary.logError('autoCapture:WebVitalsManager', error);\n    }\n  }\n  _handleMetric(metric) {\n    if (this._metricEvent.firstMetricTimestamp === undefined) {\n      this._metricEvent.firstMetricTimestamp = Date.now();\n    }\n    if (metric === undefined || (metric === null || metric === void 0 ? void 0 : metric.name) === undefined) {\n      return;\n    }\n    const currentUrl = (0, commonUtils_1._getSafeUrlString)();\n    if (currentUrl === '') {\n      // If the URL is not valid, we don't want to track the metric\n      return;\n    }\n    if (!VALID_METRIC_NAMES.includes(metric.name)) {\n      return;\n    }\n    if (currentUrl !== this._metricEvent.url) {\n      this._enqueueWebVitalsAutoCaptureEvent();\n      this._metricEvent.url = currentUrl;\n    }\n    const metricData = metric;\n    this._metricEvent.metrics.push({\n      name: metricData.name,\n      value: metricData.value,\n      delta: metricData.delta,\n      id: metricData.id\n    });\n    if (this._metricEvent.metrics.length === VALID_METRIC_NAMES.length) {\n      this._enqueueWebVitalsAutoCaptureEvent();\n    }\n  }\n  _enqueueWebVitalsAutoCaptureEvent() {\n    if (this._metricEvent.url === '' || this._metricEvent.metrics.length === 0) {\n      return;\n    }\n    const flattenedMetrics = {};\n    this._metricEvent.metrics.forEach(metric => {\n      const prefix = metric.name.toLowerCase();\n      flattenedMetrics[`${prefix}_value`] = metric.value;\n      flattenedMetrics[`${prefix}_delta`] = metric.delta;\n      flattenedMetrics[`${prefix}_id`] = metric.id;\n    });\n    this._enqueueFn(AutoCaptureEvent_1.AutoCaptureEventName.WEB_VITALS, this._metricEvent.sanitizedUrl, Object.assign(Object.assign({}, flattenedMetrics), {\n      first_metric_timestamp: this._metricEvent.firstMetricTimestamp\n    }));\n    this._metricEvent = {\n      url: (0, commonUtils_1._getSafeUrlString)(),\n      sanitizedUrl: (0, commonUtils_1._getSanitizedPageUrl)(),\n      metrics: [],\n      firstMetricTimestamp: undefined\n    };\n  }\n}\nexports.WebVitalsManager = WebVitalsManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","WebVitalsManager","web_vitals_1","require","client_core_1","AutoCaptureEvent_1","commonUtils_1","VALID_METRIC_NAMES","constructor","_enqueueFn","_errorBoundary","_isInitialized","_metricEvent","url","_getSafeUrlString","sanitizedUrl","_getSanitizedPageUrl","metrics","firstMetricTimestamp","undefined","startTracking","_a","_b","protocol","_getWindowSafe","location","onCLS","metric","_handleMetric","onFCP","onINP","onLCP","onTTFB","error","Log","logError","Date","now","name","currentUrl","includes","_enqueueWebVitalsAutoCaptureEvent","metricData","push","delta","id","length","flattenedMetrics","forEach","prefix","toLowerCase","AutoCaptureEventName","WEB_VITALS","assign","first_metric_timestamp"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/web-analytics/src/WebVitalsManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebVitalsManager = void 0;\nconst web_vitals_1 = require(\"web-vitals\");\nconst client_core_1 = require(\"@statsig/client-core\");\nconst AutoCaptureEvent_1 = require(\"./AutoCaptureEvent\");\nconst commonUtils_1 = require(\"./utils/commonUtils\");\nconst VALID_METRIC_NAMES = ['CLS', 'FCP', 'INP', 'LCP', 'TTFB'];\nclass WebVitalsManager {\n    constructor(_enqueueFn, _errorBoundary) {\n        this._enqueueFn = _enqueueFn;\n        this._errorBoundary = _errorBoundary;\n        this._isInitialized = false;\n        this._metricEvent = {\n            url: (0, commonUtils_1._getSafeUrlString)(),\n            sanitizedUrl: (0, commonUtils_1._getSanitizedPageUrl)(),\n            metrics: [],\n            firstMetricTimestamp: undefined,\n        };\n    }\n    startTracking() {\n        var _a, _b;\n        try {\n            if (this._isInitialized) {\n                return;\n            }\n            const protocol = (_b = (_a = (0, client_core_1._getWindowSafe)()) === null || _a === void 0 ? void 0 : _a.location) === null || _b === void 0 ? void 0 : _b.protocol;\n            if (protocol !== 'https:' && protocol !== 'http:') {\n                return;\n            }\n            (0, web_vitals_1.onCLS)((metric) => this._handleMetric(metric));\n            (0, web_vitals_1.onFCP)((metric) => this._handleMetric(metric));\n            (0, web_vitals_1.onINP)((metric) => this._handleMetric(metric));\n            (0, web_vitals_1.onLCP)((metric) => this._handleMetric(metric));\n            (0, web_vitals_1.onTTFB)((metric) => this._handleMetric(metric));\n            this._isInitialized = true;\n        }\n        catch (error) {\n            client_core_1.Log.error('Error starting web vitals tracking', error);\n            this._errorBoundary.logError('autoCapture:WebVitalsManager', error);\n        }\n    }\n    _handleMetric(metric) {\n        if (this._metricEvent.firstMetricTimestamp === undefined) {\n            this._metricEvent.firstMetricTimestamp = Date.now();\n        }\n        if (metric === undefined ||\n            (metric === null || metric === void 0 ? void 0 : metric.name) === undefined) {\n            return;\n        }\n        const currentUrl = (0, commonUtils_1._getSafeUrlString)();\n        if (currentUrl === '') {\n            // If the URL is not valid, we don't want to track the metric\n            return;\n        }\n        if (!VALID_METRIC_NAMES.includes(metric.name)) {\n            return;\n        }\n        if (currentUrl !== this._metricEvent.url) {\n            this._enqueueWebVitalsAutoCaptureEvent();\n            this._metricEvent.url = currentUrl;\n        }\n        const metricData = metric;\n        this._metricEvent.metrics.push({\n            name: metricData.name,\n            value: metricData.value,\n            delta: metricData.delta,\n            id: metricData.id,\n        });\n        if (this._metricEvent.metrics.length === VALID_METRIC_NAMES.length) {\n            this._enqueueWebVitalsAutoCaptureEvent();\n        }\n    }\n    _enqueueWebVitalsAutoCaptureEvent() {\n        if (this._metricEvent.url === '' ||\n            this._metricEvent.metrics.length === 0) {\n            return;\n        }\n        const flattenedMetrics = {};\n        this._metricEvent.metrics.forEach((metric) => {\n            const prefix = metric.name.toLowerCase();\n            flattenedMetrics[`${prefix}_value`] = metric.value;\n            flattenedMetrics[`${prefix}_delta`] = metric.delta;\n            flattenedMetrics[`${prefix}_id`] = metric.id;\n        });\n        this._enqueueFn(AutoCaptureEvent_1.AutoCaptureEventName.WEB_VITALS, this._metricEvent.sanitizedUrl, Object.assign(Object.assign({}, flattenedMetrics), { first_metric_timestamp: this._metricEvent.firstMetricTimestamp }));\n        this._metricEvent = {\n            url: (0, commonUtils_1._getSafeUrlString)(),\n            sanitizedUrl: (0, commonUtils_1._getSanitizedPageUrl)(),\n            metrics: [],\n            firstMetricTimestamp: undefined,\n        };\n    }\n}\nexports.WebVitalsManager = WebVitalsManager;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}