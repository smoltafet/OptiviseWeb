{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StatsigSession = exports.SessionID = void 0;\nconst __StatsigGlobal_1 = require(\"./$_StatsigGlobal\");\nconst CacheKey_1 = require(\"./CacheKey\");\nconst Log_1 = require(\"./Log\");\nconst StorageProvider_1 = require(\"./StorageProvider\");\nconst UUID_1 = require(\"./UUID\");\nconst MAX_SESSION_IDLE_TIME = 30 * 60 * 1000; // 30 minutes\nconst MAX_SESSION_AGE = 4 * 60 * 60 * 1000; // 4 hours\nconst PROMISE_MAP = {};\nexports.SessionID = {\n  get: sdkKey => {\n    return exports.StatsigSession.get(sdkKey).data.sessionID;\n  }\n};\nexports.StatsigSession = {\n  get: sdkKey => {\n    if (PROMISE_MAP[sdkKey] == null) {\n      PROMISE_MAP[sdkKey] = _loadSession(sdkKey);\n    }\n    const session = PROMISE_MAP[sdkKey];\n    return _bumpSession(session);\n  },\n  overrideInitialSessionID: (override, sdkKey) => {\n    PROMISE_MAP[sdkKey] = _overrideSessionId(override, sdkKey);\n  }\n};\nfunction _loadSession(sdkKey) {\n  let data = _loadFromStorage(sdkKey);\n  const now = Date.now();\n  if (!data) {\n    data = {\n      sessionID: (0, UUID_1.getUUID)(),\n      startTime: now,\n      lastUpdate: now\n    };\n  }\n  return {\n    data,\n    sdkKey\n  };\n}\nfunction _overrideSessionId(override, sdkKey) {\n  const now = Date.now();\n  return {\n    data: {\n      sessionID: override,\n      startTime: now,\n      lastUpdate: now\n    },\n    sdkKey\n  };\n}\nfunction _bumpSession(session) {\n  const now = Date.now();\n  const data = session.data;\n  const sdkKey = session.sdkKey;\n  if (_isIdle(data) || _hasRunTooLong(data)) {\n    data.sessionID = (0, UUID_1.getUUID)();\n    data.startTime = now;\n    const client = __STATSIG__ === null || __STATSIG__ === void 0 ? void 0 : __STATSIG__.instance(sdkKey);\n    if (client) {\n      client.$emt({\n        name: 'session_expired'\n      });\n    }\n  }\n  data.lastUpdate = now;\n  _persistToStorage(data, session.sdkKey);\n  clearTimeout(session.idleTimeoutID);\n  clearTimeout(session.ageTimeoutID);\n  const lifetime = now - data.startTime;\n  session.idleTimeoutID = _createSessionTimeout(sdkKey, MAX_SESSION_IDLE_TIME);\n  session.ageTimeoutID = _createSessionTimeout(sdkKey, MAX_SESSION_AGE - lifetime);\n  return session;\n}\nfunction _createSessionTimeout(sdkKey, duration) {\n  return setTimeout(() => {\n    var _a;\n    const client = (_a = (0, __StatsigGlobal_1._getStatsigGlobal)()) === null || _a === void 0 ? void 0 : _a.instance(sdkKey);\n    if (client) {\n      client.$emt({\n        name: 'session_expired'\n      });\n    }\n  }, duration);\n}\nfunction _isIdle({\n  lastUpdate\n}) {\n  return Date.now() - lastUpdate > MAX_SESSION_IDLE_TIME;\n}\nfunction _hasRunTooLong({\n  startTime\n}) {\n  return Date.now() - startTime > MAX_SESSION_AGE;\n}\nfunction _getSessionIDStorageKey(sdkKey) {\n  return `statsig.session_id.${(0, CacheKey_1._getStorageKey)(sdkKey)}`;\n}\nfunction _persistToStorage(session, sdkKey) {\n  const storageKey = _getSessionIDStorageKey(sdkKey);\n  try {\n    (0, StorageProvider_1._setObjectInStorage)(storageKey, session);\n  } catch (e) {\n    Log_1.Log.warn('Failed to save SessionID');\n  }\n}\nfunction _loadFromStorage(sdkKey) {\n  const storageKey = _getSessionIDStorageKey(sdkKey);\n  return (0, StorageProvider_1._getObjectFromStorage)(storageKey);\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","StatsigSession","SessionID","__StatsigGlobal_1","require","CacheKey_1","Log_1","StorageProvider_1","UUID_1","MAX_SESSION_IDLE_TIME","MAX_SESSION_AGE","PROMISE_MAP","get","sdkKey","data","sessionID","_loadSession","session","_bumpSession","overrideInitialSessionID","override","_overrideSessionId","_loadFromStorage","now","Date","getUUID","startTime","lastUpdate","_isIdle","_hasRunTooLong","client","__STATSIG__","instance","$emt","name","_persistToStorage","clearTimeout","idleTimeoutID","ageTimeoutID","lifetime","_createSessionTimeout","duration","setTimeout","_a","_getStatsigGlobal","_getSessionIDStorageKey","_getStorageKey","storageKey","_setObjectInStorage","e","Log","warn","_getObjectFromStorage"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/client-core/src/SessionID.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StatsigSession = exports.SessionID = void 0;\nconst __StatsigGlobal_1 = require(\"./$_StatsigGlobal\");\nconst CacheKey_1 = require(\"./CacheKey\");\nconst Log_1 = require(\"./Log\");\nconst StorageProvider_1 = require(\"./StorageProvider\");\nconst UUID_1 = require(\"./UUID\");\nconst MAX_SESSION_IDLE_TIME = 30 * 60 * 1000; // 30 minutes\nconst MAX_SESSION_AGE = 4 * 60 * 60 * 1000; // 4 hours\nconst PROMISE_MAP = {};\nexports.SessionID = {\n    get: (sdkKey) => {\n        return exports.StatsigSession.get(sdkKey).data.sessionID;\n    },\n};\nexports.StatsigSession = {\n    get: (sdkKey) => {\n        if (PROMISE_MAP[sdkKey] == null) {\n            PROMISE_MAP[sdkKey] = _loadSession(sdkKey);\n        }\n        const session = PROMISE_MAP[sdkKey];\n        return _bumpSession(session);\n    },\n    overrideInitialSessionID: (override, sdkKey) => {\n        PROMISE_MAP[sdkKey] = _overrideSessionId(override, sdkKey);\n    },\n};\nfunction _loadSession(sdkKey) {\n    let data = _loadFromStorage(sdkKey);\n    const now = Date.now();\n    if (!data) {\n        data = {\n            sessionID: (0, UUID_1.getUUID)(),\n            startTime: now,\n            lastUpdate: now,\n        };\n    }\n    return {\n        data,\n        sdkKey,\n    };\n}\nfunction _overrideSessionId(override, sdkKey) {\n    const now = Date.now();\n    return {\n        data: {\n            sessionID: override,\n            startTime: now,\n            lastUpdate: now,\n        },\n        sdkKey,\n    };\n}\nfunction _bumpSession(session) {\n    const now = Date.now();\n    const data = session.data;\n    const sdkKey = session.sdkKey;\n    if (_isIdle(data) || _hasRunTooLong(data)) {\n        data.sessionID = (0, UUID_1.getUUID)();\n        data.startTime = now;\n        const client = __STATSIG__ === null || __STATSIG__ === void 0 ? void 0 : __STATSIG__.instance(sdkKey);\n        if (client) {\n            client.$emt({ name: 'session_expired' });\n        }\n    }\n    data.lastUpdate = now;\n    _persistToStorage(data, session.sdkKey);\n    clearTimeout(session.idleTimeoutID);\n    clearTimeout(session.ageTimeoutID);\n    const lifetime = now - data.startTime;\n    session.idleTimeoutID = _createSessionTimeout(sdkKey, MAX_SESSION_IDLE_TIME);\n    session.ageTimeoutID = _createSessionTimeout(sdkKey, MAX_SESSION_AGE - lifetime);\n    return session;\n}\nfunction _createSessionTimeout(sdkKey, duration) {\n    return setTimeout(() => {\n        var _a;\n        const client = (_a = (0, __StatsigGlobal_1._getStatsigGlobal)()) === null || _a === void 0 ? void 0 : _a.instance(sdkKey);\n        if (client) {\n            client.$emt({ name: 'session_expired' });\n        }\n    }, duration);\n}\nfunction _isIdle({ lastUpdate }) {\n    return Date.now() - lastUpdate > MAX_SESSION_IDLE_TIME;\n}\nfunction _hasRunTooLong({ startTime }) {\n    return Date.now() - startTime > MAX_SESSION_AGE;\n}\nfunction _getSessionIDStorageKey(sdkKey) {\n    return `statsig.session_id.${(0, CacheKey_1._getStorageKey)(sdkKey)}`;\n}\nfunction _persistToStorage(session, sdkKey) {\n    const storageKey = _getSessionIDStorageKey(sdkKey);\n    try {\n        (0, StorageProvider_1._setObjectInStorage)(storageKey, session);\n    }\n    catch (e) {\n        Log_1.Log.warn('Failed to save SessionID');\n    }\n}\nfunction _loadFromStorage(sdkKey) {\n    const storageKey = _getSessionIDStorageKey(sdkKey);\n    return (0, StorageProvider_1._getObjectFromStorage)(storageKey);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}