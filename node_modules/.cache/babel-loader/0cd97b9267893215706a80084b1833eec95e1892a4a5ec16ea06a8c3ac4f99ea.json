{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionReplay = exports.runStatsigSessionReplay = exports.StatsigSessionReplayPlugin = void 0;\nconst client_core_1 = require(\"@statsig/client-core\");\nconst SessionReplayBase_1 = require(\"./SessionReplayBase\");\nconst SessionReplayUtils_1 = require(\"./SessionReplayUtils\");\nclass StatsigSessionReplayPlugin {\n  constructor(options) {\n    this.options = options;\n    this.__plugin = 'session-replay';\n  }\n  bind(client) {\n    runStatsigSessionReplay(client, this.options);\n  }\n}\nexports.StatsigSessionReplayPlugin = StatsigSessionReplayPlugin;\nfunction runStatsigSessionReplay(client, options) {\n  new SessionReplay(client, options);\n}\nexports.runStatsigSessionReplay = runStatsigSessionReplay;\nclass SessionReplay extends SessionReplayBase_1.SessionReplayBase {\n  constructor(client, options) {\n    var _a;\n    super(client, options);\n    this._client.$on('values_updated', () => {\n      var _a;\n      if (!this._wasStopped) {\n        this._attemptToStartRecording((_a = this._options) === null || _a === void 0 ? void 0 : _a.forceRecording);\n      }\n    });\n    this._attemptToStartRecording((_a = this._options) === null || _a === void 0 ? void 0 : _a.forceRecording);\n  }\n  _shutdown(endReason) {\n    super._shutdownImpl(endReason);\n  }\n  _attemptToStartRecording(force = false) {\n    var _a, _b;\n    if (this._totalLogs >= SessionReplayUtils_1.MAX_LOGS) {\n      return;\n    }\n    const values = this._client.getContext().values;\n    if ((values === null || values === void 0 ? void 0 : values.recording_blocked) === true) {\n      this._shutdown();\n      return;\n    }\n    if (!force && (values === null || values === void 0 ? void 0 : values.can_record_session) !== true) {\n      this._shutdown();\n      return;\n    }\n    if ((values === null || values === void 0 ? void 0 : values.passes_session_recording_targeting) === false) {\n      this._shutdown();\n      return;\n    }\n    if (this._replayer.isRecording()) {\n      return;\n    }\n    this._wasStopped = false;\n    client_core_1.StatsigMetadataProvider.add({\n      isRecordingSession: 'true'\n    });\n    this._replayer.record((e, d) => this._onRecordingEvent(e, d), (_b = (_a = this._options) === null || _a === void 0 ? void 0 : _a.rrwebConfig) !== null && _b !== void 0 ? _b : {}, () => {\n      this._shutdown();\n    });\n  }\n}\nexports.SessionReplay = SessionReplay;","map":{"version":3,"names":["Object","defineProperty","exports","value","SessionReplay","runStatsigSessionReplay","StatsigSessionReplayPlugin","client_core_1","require","SessionReplayBase_1","SessionReplayUtils_1","constructor","options","__plugin","bind","client","SessionReplayBase","_a","_client","$on","_wasStopped","_attemptToStartRecording","_options","forceRecording","_shutdown","endReason","_shutdownImpl","force","_b","_totalLogs","MAX_LOGS","values","getContext","recording_blocked","can_record_session","passes_session_recording_targeting","_replayer","isRecording","StatsigMetadataProvider","add","isRecordingSession","record","e","d","_onRecordingEvent","rrwebConfig"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/session-replay/src/SessionReplay.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SessionReplay = exports.runStatsigSessionReplay = exports.StatsigSessionReplayPlugin = void 0;\nconst client_core_1 = require(\"@statsig/client-core\");\nconst SessionReplayBase_1 = require(\"./SessionReplayBase\");\nconst SessionReplayUtils_1 = require(\"./SessionReplayUtils\");\nclass StatsigSessionReplayPlugin {\n    constructor(options) {\n        this.options = options;\n        this.__plugin = 'session-replay';\n    }\n    bind(client) {\n        runStatsigSessionReplay(client, this.options);\n    }\n}\nexports.StatsigSessionReplayPlugin = StatsigSessionReplayPlugin;\nfunction runStatsigSessionReplay(client, options) {\n    new SessionReplay(client, options);\n}\nexports.runStatsigSessionReplay = runStatsigSessionReplay;\nclass SessionReplay extends SessionReplayBase_1.SessionReplayBase {\n    constructor(client, options) {\n        var _a;\n        super(client, options);\n        this._client.$on('values_updated', () => {\n            var _a;\n            if (!this._wasStopped) {\n                this._attemptToStartRecording((_a = this._options) === null || _a === void 0 ? void 0 : _a.forceRecording);\n            }\n        });\n        this._attemptToStartRecording((_a = this._options) === null || _a === void 0 ? void 0 : _a.forceRecording);\n    }\n    _shutdown(endReason) {\n        super._shutdownImpl(endReason);\n    }\n    _attemptToStartRecording(force = false) {\n        var _a, _b;\n        if (this._totalLogs >= SessionReplayUtils_1.MAX_LOGS) {\n            return;\n        }\n        const values = this._client.getContext().values;\n        if ((values === null || values === void 0 ? void 0 : values.recording_blocked) === true) {\n            this._shutdown();\n            return;\n        }\n        if (!force && (values === null || values === void 0 ? void 0 : values.can_record_session) !== true) {\n            this._shutdown();\n            return;\n        }\n        if ((values === null || values === void 0 ? void 0 : values.passes_session_recording_targeting) === false) {\n            this._shutdown();\n            return;\n        }\n        if (this._replayer.isRecording()) {\n            return;\n        }\n        this._wasStopped = false;\n        client_core_1.StatsigMetadataProvider.add({ isRecordingSession: 'true' });\n        this._replayer.record((e, d) => this._onRecordingEvent(e, d), (_b = (_a = this._options) === null || _a === void 0 ? void 0 : _a.rrwebConfig) !== null && _b !== void 0 ? _b : {}, () => {\n            this._shutdown();\n        });\n    }\n}\nexports.SessionReplay = SessionReplay;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}