{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ConsoleLogManager = void 0;\n/* eslint-disable no-console */\nconst client_core_1 = require(\"@statsig/client-core\");\nconst AutoCaptureEvent_1 = require(\"./AutoCaptureEvent\");\nconst commonUtils_1 = require(\"./utils/commonUtils\");\nconst consoleLogsUtils_1 = require(\"./utils/consoleLogsUtils\");\nconst metadataUtils_1 = require(\"./utils/metadataUtils\");\nconst ConsoleLogPriority = {\n  trace: 10,\n  debug: 20,\n  log: 30,\n  // log & info are the same priority\n  info: 30,\n  warn: 40,\n  error: 50\n};\nconst DEFAULT_MAX_KEYS = 10;\nconst DEFAULT_MAX_DEPTH = 10;\nconst DEFAULT_MAX_STRING_LENGTH = 500;\nclass ConsoleLogManager {\n  constructor(_enqueueFn, _errorBoundary, _options) {\n    var _a, _b, _c, _d;\n    this._enqueueFn = _enqueueFn;\n    this._errorBoundary = _errorBoundary;\n    this._options = _options;\n    this._restoreFns = [];\n    this._isTracking = false;\n    this._logLevel = 'info';\n    this.__source = 'js-auto-capture';\n    this._logLevel = (_a = this._options.logLevel) !== null && _a !== void 0 ? _a : 'info';\n    this._maxKeys = (_b = this._options.maxKeys) !== null && _b !== void 0 ? _b : DEFAULT_MAX_KEYS;\n    this._maxDepth = (_c = this._options.maxDepth) !== null && _c !== void 0 ? _c : DEFAULT_MAX_DEPTH;\n    this._maxStringLength = (_d = this._options.maxStringLength) !== null && _d !== void 0 ? _d : DEFAULT_MAX_STRING_LENGTH;\n  }\n  startTracking() {\n    try {\n      if (this._isTracking || !this._options.enabled) return;\n      const win = (0, client_core_1._getWindowSafe)();\n      if (!win) return;\n      this._patchConsole();\n      this._isTracking = true;\n    } catch (error) {\n      client_core_1.Log.error('Error starting console log tracking', error);\n      this._errorBoundary.logError('autoCapture:ConsoleLogManager', error);\n    }\n  }\n  stopTracking() {\n    if (!this._isTracking) return;\n    this._restoreFns.forEach(restore => restore());\n    this._restoreFns = [];\n    this._isTracking = false;\n  }\n  _patchConsole() {\n    Object.entries(ConsoleLogPriority).forEach(([level, priority]) => {\n      if (priority < ConsoleLogPriority[this._logLevel]) return;\n      if (!console[level]) return;\n      const original = console[level].bind(console);\n      let inStack = false;\n      const restore = (0, commonUtils_1.wrapFunctionWithRestore)(console, level, originalFn => {\n        return (...args) => {\n          originalFn(...args);\n          if (inStack) return;\n          inStack = true;\n          try {\n            const payload = args.map(a => (0, consoleLogsUtils_1._safeStringify)(a, this._maxKeys, this._maxDepth, this._maxStringLength));\n            const trace = (0, consoleLogsUtils_1._getStackTrace)();\n            this._enqueueConsoleLog(level, payload, trace);\n          } catch (err) {\n            original('console observer error:', err, ...args);\n            this._errorBoundary.logError('autoCapture:ConsoleLogManager', err);\n          } finally {\n            inStack = false;\n          }\n        };\n      });\n      this._restoreFns.push(restore);\n    });\n  }\n  _enqueueConsoleLog(level, payload, trace) {\n    if (!this._shouldLog()) return;\n    const metadata = Object.assign({\n      status: level === 'log' ? 'info' : level,\n      log_level: level,\n      payload,\n      trace,\n      timestamp: Date.now(),\n      source: this.__source\n    }, (0, metadataUtils_1._gatherAllMetadata)((0, commonUtils_1._getSafeUrl)()));\n    this._enqueueFn(AutoCaptureEvent_1.AutoCaptureEventName.CONSOLE_LOG, payload.join(' '), metadata);\n  }\n  _shouldLog() {\n    if (!this._options.sampleRate || typeof this._options.sampleRate !== 'number' || this._options.sampleRate <= 0 || this._options.sampleRate >= 1) {\n      return true;\n    }\n    return Math.random() < this._options.sampleRate;\n  }\n}\nexports.ConsoleLogManager = ConsoleLogManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","ConsoleLogManager","client_core_1","require","AutoCaptureEvent_1","commonUtils_1","consoleLogsUtils_1","metadataUtils_1","ConsoleLogPriority","trace","debug","log","info","warn","error","DEFAULT_MAX_KEYS","DEFAULT_MAX_DEPTH","DEFAULT_MAX_STRING_LENGTH","constructor","_enqueueFn","_errorBoundary","_options","_a","_b","_c","_d","_restoreFns","_isTracking","_logLevel","__source","logLevel","_maxKeys","maxKeys","_maxDepth","maxDepth","_maxStringLength","maxStringLength","startTracking","enabled","win","_getWindowSafe","_patchConsole","Log","logError","stopTracking","forEach","restore","entries","level","priority","console","original","bind","inStack","wrapFunctionWithRestore","originalFn","args","payload","map","a","_safeStringify","_getStackTrace","_enqueueConsoleLog","err","push","_shouldLog","metadata","assign","status","log_level","timestamp","Date","now","source","_gatherAllMetadata","_getSafeUrl","AutoCaptureEventName","CONSOLE_LOG","join","sampleRate","Math","random"],"sources":["/Users/sidiq/Documents/OptiviseWeb/node_modules/@statsig/web-analytics/src/ConsoleLogManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ConsoleLogManager = void 0;\n/* eslint-disable no-console */\nconst client_core_1 = require(\"@statsig/client-core\");\nconst AutoCaptureEvent_1 = require(\"./AutoCaptureEvent\");\nconst commonUtils_1 = require(\"./utils/commonUtils\");\nconst consoleLogsUtils_1 = require(\"./utils/consoleLogsUtils\");\nconst metadataUtils_1 = require(\"./utils/metadataUtils\");\nconst ConsoleLogPriority = {\n    trace: 10,\n    debug: 20,\n    log: 30, // log & info are the same priority\n    info: 30,\n    warn: 40,\n    error: 50,\n};\nconst DEFAULT_MAX_KEYS = 10;\nconst DEFAULT_MAX_DEPTH = 10;\nconst DEFAULT_MAX_STRING_LENGTH = 500;\nclass ConsoleLogManager {\n    constructor(_enqueueFn, _errorBoundary, _options) {\n        var _a, _b, _c, _d;\n        this._enqueueFn = _enqueueFn;\n        this._errorBoundary = _errorBoundary;\n        this._options = _options;\n        this._restoreFns = [];\n        this._isTracking = false;\n        this._logLevel = 'info';\n        this.__source = 'js-auto-capture';\n        this._logLevel = (_a = this._options.logLevel) !== null && _a !== void 0 ? _a : 'info';\n        this._maxKeys = (_b = this._options.maxKeys) !== null && _b !== void 0 ? _b : DEFAULT_MAX_KEYS;\n        this._maxDepth = (_c = this._options.maxDepth) !== null && _c !== void 0 ? _c : DEFAULT_MAX_DEPTH;\n        this._maxStringLength =\n            (_d = this._options.maxStringLength) !== null && _d !== void 0 ? _d : DEFAULT_MAX_STRING_LENGTH;\n    }\n    startTracking() {\n        try {\n            if (this._isTracking || !this._options.enabled)\n                return;\n            const win = (0, client_core_1._getWindowSafe)();\n            if (!win)\n                return;\n            this._patchConsole();\n            this._isTracking = true;\n        }\n        catch (error) {\n            client_core_1.Log.error('Error starting console log tracking', error);\n            this._errorBoundary.logError('autoCapture:ConsoleLogManager', error);\n        }\n    }\n    stopTracking() {\n        if (!this._isTracking)\n            return;\n        this._restoreFns.forEach((restore) => restore());\n        this._restoreFns = [];\n        this._isTracking = false;\n    }\n    _patchConsole() {\n        Object.entries(ConsoleLogPriority).forEach(([level, priority]) => {\n            if (priority < ConsoleLogPriority[this._logLevel])\n                return;\n            if (!console[level])\n                return;\n            const original = console[level].bind(console);\n            let inStack = false;\n            const restore = (0, commonUtils_1.wrapFunctionWithRestore)(console, level, (originalFn) => {\n                return (...args) => {\n                    originalFn(...args);\n                    if (inStack)\n                        return;\n                    inStack = true;\n                    try {\n                        const payload = args.map((a) => (0, consoleLogsUtils_1._safeStringify)(a, this._maxKeys, this._maxDepth, this._maxStringLength));\n                        const trace = (0, consoleLogsUtils_1._getStackTrace)();\n                        this._enqueueConsoleLog(level, payload, trace);\n                    }\n                    catch (err) {\n                        original('console observer error:', err, ...args);\n                        this._errorBoundary.logError('autoCapture:ConsoleLogManager', err);\n                    }\n                    finally {\n                        inStack = false;\n                    }\n                };\n            });\n            this._restoreFns.push(restore);\n        });\n    }\n    _enqueueConsoleLog(level, payload, trace) {\n        if (!this._shouldLog())\n            return;\n        const metadata = Object.assign({ status: level === 'log' ? 'info' : level, log_level: level, payload,\n            trace, timestamp: Date.now(), source: this.__source }, (0, metadataUtils_1._gatherAllMetadata)((0, commonUtils_1._getSafeUrl)()));\n        this._enqueueFn(AutoCaptureEvent_1.AutoCaptureEventName.CONSOLE_LOG, payload.join(' '), metadata);\n    }\n    _shouldLog() {\n        if (!this._options.sampleRate ||\n            typeof this._options.sampleRate !== 'number' ||\n            this._options.sampleRate <= 0 ||\n            this._options.sampleRate >= 1) {\n            return true;\n        }\n        return Math.random() < this._options.sampleRate;\n    }\n}\nexports.ConsoleLogManager = ConsoleLogManager;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}